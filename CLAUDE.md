# AI審査員アプリ設計書

## プロジェクト概要

学生の社会問題解決アイディアピッチコンテスト向けのAI審査員システム。スライド資料と発表音声を分析し、ポジティブな評価と建設的な質問を自動生成する。

### 目的
- 学生のピッチ発表に対する即座のフィードバック提供
- 審査の客観性と一貫性の確保  
- 教育的価値のある質問・アドバイス生成

## 技術仕様

### フロントエンド
- **言語**: HTML5, CSS3, JavaScript (ES6+)
- **UI Framework**: なし（Vanilla JS）
- **ファイル処理**: File API, FileReader API
- **音声処理**: Web Audio API（オプション）

### AI API
- **OpenAI GPT-4o**: 総合評価・質問生成（ストリーミング対応）
- **OpenAI GPT-4 Vision**: スライド画像・PDF分析
- **OpenAI Whisper**: 音声テキスト変換
- **OpenAI TTS**: 質問音声出力（審査員別音声）

### 制約
- クライアントサイドのみ（サーバー不要）
- ファイルサイズ制限: スライド25MB、音声25MB
- 対応フォーマット: PDF, JPG, PNG, MP3, WAV, M4A

## アーキテクチャ設計

### ファイル構成
```
ai-judge-app/
├── index.html           # メインページ
├── styles.css           # スタイルシート
├── script.js            # メインロジック
├── config.js            # API設定
├── judges/
│   └── personalities.js # 審査員パーソナリティ定義
├── utils/
│   ├── fileHandler.js   # ファイル処理ユーティリティ
│   ├── apiClient.js     # OpenAI API クライアント
│   ├── uiController.js  # UI制御
│   ├── judgeSelector.js # 審査員選択機能
│   └── voiceController.js # 音声出力制御
└── README.md            # 使用方法
```

### データフロー
```
1. ファイルアップロード（スライド + 音声）
2. 並行処理:
   - 音声 → Whisper API → テキスト変換
   - スライド → GPT-4 Vision → 内容抽出
3. 統合データ → GPT-4o → 評価・質問生成（ストリーミング）
4. 結果をリアルタイム表示
```

## 機能仕様

### 1. ファイルアップロード機能
- **スライド**: ドラッグ&ドロップ、ファイル選択
  - 対応形式: PDF, JPG, PNG
  - プレビュー表示
  - 複数ページPDF対応
- **音声**: ファイル選択、録音機能（オプション）
  - 対応形式: MP3, WAV, M4A
  - 再生プレビュー

### 2. AI分析機能
- **音声分析**: 
  - Whisper APIで文字起こし
  - 発言内容の要約
  - キーワード抽出
- **スライド分析**:
  - GPT-4 Visionで画像・テキスト解析
  - 構成・デザイン評価
  - 論理性チェック
- **総合評価**:
  - ポジティブフィードバック生成
  - 改善提案
  - 深掘り質問3-5個

### 3. 審査員パーソナリティ選択
- **4つの審査員タイプ**:
  - 🎓 大学教員: 学術的・教育的観点
  - 💼 実業家: 実践的・市場性重視
  - 💰 ベンチャーキャピタリスト: 投資価値・スケーラビリティ
  - 💻 IT専門家: 技術的実現性・デジタル化
- **複数審査員同時選択**: 異なる視点での評価比較
- **審査員プロフィール表示**: 各専門分野の説明

### 5. 音声出力機能（Phase 4）
- **質問音声化**: 各審査員の質問をTTSで音声化
- **審査員別音声**: 専門性に応じた音声キャラクター
- **再生制御**: 再生/停止/速度調整/音量調整
- **音声ガイダンス**: 操作説明やヒントの音声案内
- **一括再生**: 全質問の連続再生機能
### 6. 結果表示機能
- **ストリーミング表示**: タイプライター効果
- **審査員別表示**: タブ切り替えまたは並列表示
- **セクション分け**: 評価→質問→アドバイス
- **エクスポート**: テキスト、PDF出力
- **再分析**: 審査員変更して再実行

## UI/UX設計

### レイアウト
```
┌─────────────────────────────────────┐
│ AI審査員システム - ピッチ評価        │
├─────────────────────────────────────│
│ 審査員を選択:                       │
│ [🎓大学教員] [💼実業家] [💰VC] [💻IT専門家] │
├─────────────────────────────────────│
│ [スライドアップロード] [音声アップロード] │
│ ┌─────────────┐ ┌─────────────────┐ │
│ │スライドプレビュー│ │音声プレビュー     │ │
│ └─────────────┘ └─────────────────┘ │
│               [分析開始]             │
├─────────────────────────────────────│
│ 分析結果:                           │
│ ┌─Tab:🎓教員─┐┌─Tab:💼実業家─┐     │
│ │📊 評価スコア ││📊 評価スコア  │     │
│ │🎯 フィードバック││🎯 フィードバック│     │
│ │❓ 質問・深掘り ││❓ 質問・深掘り │     │
│ │  🔊 [質問を聞く]││  🔊 [質問を聞く]│     │
│ │  ⏸️ [停止] 🔄 [再生]│  ⏸️ [停止] 🔄 [再生]│     │
│ │💡 アドバイス ││💡 アドバイス  │     │
│ └─────────────┘└─────────────┘     │
│ │📤 [エクスポート] [再分析]        │ │
│ └─────────────────────────────────┘ │
└─────────────────────────────────────┘
```

### デザインガイドライン
- **カラーテーマ**: 青系（信頼性）+ 緑系（ポジティブ）
- **フォント**: 読みやすいサンセリフ
- **アニメーション**: 分析中のローディング、結果のフェードイン
- **レスポンシブ**: タブレット・スマホ対応

## API統合設計

### OpenAI API設定
```javascript
const OPENAI_CONFIG = {
  apiKey: 'user-provided', // 環境変数または設定画面で入力
  baseURL: 'https://api.openai.com/v1',
  models: {
    vision: 'gpt-4o-mini',
    audio: 'whisper-1', 
    text: 'gpt-4o'
  }
};
```

### API呼び出しフロー
1. **音声処理**: `/audio/transcriptions` (Whisper)
2. **画像処理**: `/chat/completions` (GPT-4 Vision)
3. **評価生成**: `/chat/completions` (GPT-4o, stream=true)
4. **音声合成**: `/audio/speech` (TTS) - 質問音声化

### 音声出力機能
```javascript
const VOICE_CONFIG = {
  baseURL: 'https://api.openai.com/v1/audio/speech',
  supportedVoices: ['alloy', 'echo', 'fable', 'onyx', 'nova', 'shimmer'],
  responseFormat: 'mp3',
  speedRange: [0.25, 4.0],
  defaultSettings: {
    volume: 0.8,
    autoplay: false,
    showControls: true
  }
};

// 音声生成関数例
async function generateQuestionAudio(text, judgeType) {
  const voice = JUDGE_PERSONALITIES[judgeType].voice;
  const response = await fetch('/audio/speech', {
    method: 'POST',
    headers: {
      'Authorization': `Bearer ${apiKey}`,
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      model: voice.model,
      input: text,
      voice: voice.voice,
      speed: voice.speed
    })
  });
  return response.blob();
}
```

### プロンプト設計
```javascript
const JUDGE_PERSONALITIES = {
  professor: {
    name: "大学教員",
    icon: "🎓",
    description: "学術的な視点で教育的価値と論理性を重視",
    voice: {
      model: "tts-1",
      voice: "fable",  // 落ち着いた知的な音声
      speed: 0.9       // やや遅めの丁寧な話し方
    },
    systemPrompt: `
      あなたは大学で社会問題研究を専門とする教授です。
      学生のピッチを教育的観点から評価してください。
      
      【評価観点】
      - 社会課題の学術的理解の深さ
      - 論理的思考と根拠の妥当性  
      - 先行研究との関連性
      - 学習・成長の可能性
      
      【フィードバックスタイル】
      - 丁寧で教育的
      - 理論的背景を重視
      - 学習機会を提供する質問
      - 学術的な改善提案
    `,
    questions: [
      "この問題についてどのような先行研究を調べましたか？",
      "仮説の根拠となるデータはありますか？",
      "他の理論的アプローチは検討しましたか？"
    ]
  },
  
  entrepreneur: {
    name: "実業家", 
    icon: "💼",
    description: "実践的な市場性と実現可能性を重視",
    voice: {
      model: "tts-1",
      voice: "onyx",   // 力強く自信に満ちた音声
      speed: 1.1       // やや早めのテンポ良い話し方
    },
    systemPrompt: `
      あなたは複数の事業を成功させた経験豊富な実業家です。
      ビジネスの実現可能性と市場価値の観点から評価してください。
      
      【評価観点】
      - 市場ニーズの実在性
      - ビジネスモデルの収益性
      - 競合との差別化
      - 実行計画の現実性
      
      【フィードバックスタイル】
      - 実践的で率直
      - 市場の厳しさも伝える
      - 具体的な行動提案
      - 経験に基づくアドバイス
    `,
    questions: [
      "顧客は本当にお金を払ってくれますか？",
      "競合他社はどう対抗してくると思いますか？",
      "最初の100人の顧客をどう獲得しますか？"
    ]
  },
  
  vc: {
    name: "ベンチャーキャピタリスト",
    icon: "💰", 
    description: "投資価値とスケーラビリティを重視",
    voice: {
      model: "tts-1",
      voice: "alloy",  # 洗練された分析的な音声
      speed: 1.0       # 標準的な明確な話し方
    },
    systemPrompt: `
      あなたは多くのスタートアップに投資してきたVCです。
      投資対象としての魅力と成長性を評価してください。
      
      【評価観点】
      - 市場規模と成長性（TAM/SAM/SOM）
      - スケーラビリティ
      - 競争優位性とディフェンシビリティ
      - チームの実行力
      - 投資回収の可能性
      
      【フィードバックスタイル】
      - 投資家目線で厳格
      - データドリブン
      - 成長戦略重視
      - リスクと機会の両面評価
    `,
    questions: [
      "この市場は10倍に成長する可能性がありますか？",
      "なぜ今がタイミングなのですか？", 
      "5年後に100億円企業になれますか？"
    ]
  },
  
  tech_expert: {
    name: "IT専門家",
    icon: "💻",
    description: "技術的実現性とデジタル化の観点を重視",
    voice: {
      model: "tts-1",
      voice: "echo",   // クリアで技術的な音声
      speed: 1.0       # 正確で明瞭な話し方
    },
    systemPrompt: `
      あなたは最新技術に精通したIT専門家です。
      技術的な実現可能性とデジタル化の観点から評価してください。
      
      【評価観点】
      - 技術的実現可能性
      - システム設計の妥当性
      - データ活用の可能性
      - AIやIoTなど新技術の適用
      - セキュリティとプライバシー
      
      【フィードバックスタイル】
      - 技術的に正確
      - 実装の具体性重視
      - 最新技術の活用提案
      - セキュリティ意識
    `,
    questions: [
      "このシステムはどの技術スタックで構築しますか？",
      "データ収集と分析の方法は？",
      "セキュリティ対策は十分ですか？"
    ]
  }
};

const PROMPTS = {
  slideAnalysis: `
    スライドを分析して以下を抽出してください：
    - 提案する社会問題
    - 解決アイデアの概要  
    - ビジネスモデル
    - 実現可能性
    - プレゼンの構成
  `,
  
  evaluation: (personality) => `
    ${personality.systemPrompt}
    
    【出力フォーマット】
    ## 📊 総合評価
    [5段階評価とその理由]
    
    ## 🎯 ポジティブフィードバック
    [3-4つの優れた点]
    
    ## ❓ 深掘り質問 
    [3-5つの質問]
    
    ## 💡 改善アドバイス
    [具体的な改善提案2-3点]
  `
};
```

## 実装優先度

### Phase 1（MVP）
- [x] 基本UI作成
- [x] 審査員パーソナリティ選択UI
- [x] ファイルアップロード機能
- [x] OpenAI API統合
- [x] 単一審査員での評価生成

### Phase 1.5（PDF/PowerPoint特化）
- [x] PDFテキスト抽出機能の強化
- [x] PowerPoint(.ppt/.pptx)読み込み対応
- [x] ファイル形式をPDF/PowerPointのみに限定
- [x] レイアウト保持型PDF解析
- [x] PowerPoint図形・ノート抽出

### Phase 2（機能拡張）
- [x] 複数審査員同時評価
- [x] ストリーミング表示
- [x] 審査員別タブ表示
- [x] 結果エクスポート
- [x] 録音機能

### Phase 3（体験向上）
- [x] 審査員比較表示
- [x] アニメーション追加
- [x] 評価履歴保存
- [ ] カスタム審査員作成
- [ ] 設定カスタマイズ
- [ ] マルチ言語対応

### Phase 4（音声対話機能）
- [ ] 質問音声出力（TTS）
- [ ] 審査員別音声キャラクター
- [ ] 音声再生制御（再生/停止/速度調整）
- [ ] 音声ガイダンス機能
- [ ] 音声での追加質問機能（オプション）

## エラーハンドリング

### 想定エラー
- APIキー未設定/無効
- ファイルサイズ超過
- 対応外フォーマット
- ネットワークエラー
- API制限エラー
- 音声再生エラー（ブラウザ対応）
- TTS生成失敗
- 音声ファイル破損

### 対応方針
- 明確なエラーメッセージ表示
- リトライ機能
- フォールバック処理
- ユーザーガイダンス

## セキュリティ考慮事項

### データ保護
- ファイルはローカル処理のみ
- APIキーはブラウザ保存（注意喚起）
- 通信はHTTPS必須
- ファイルアップロード後の自動削除

### API使用量制御
- ファイルサイズ制限
- API呼び出し頻度制限
- 使用量表示・警告

## 運用・メンテナンス

### 監視項目
- API応答時間
- エラー発生率
- ユーザー満足度

### 更新計画
- OpenAI API仕様変更への対応
- UI/UX改善
- 新機能追加

---

## Claude Code実装指示

このドキュメントを基に、以下の順序で実装してください：

1. **基本構造作成**: HTML, CSS, JavaScript基盤
2. **審査員パーソナリティシステム**: personalities.js作成、選択UI実装
3. **ファイルアップロード**: UI作成と処理ロジック
4. **API統合**: OpenAI API クライアント実装
5. **評価生成**: 審査員別プロンプト設計と結果表示
6. **複数審査員対応**: タブ表示、比較機能
7. **UI拡張**: ストリーミング、アニメーション追加
8. **音声機能実装**: TTS API統合、音声コントロールUI、審査員別音声設定
9. **音声体験向上**: 再生制御、音声ガイダンス、一括再生機能
10. **テスト・デバッグ**: 動作確認と最適化

【音声機能実装のポイント】
- 各審査員の個性を音声でも表現（声質、話速、トーン）
- 質問文の音声化で対話感のある体験を提供
- 音声コントロールで使いやすさを確保
- 高品質な音声でプロフェッショナルな印象を演出

各審査員の特色を活かした評価ができるよう、プロンプト設計に特に注意してください。音声機能により、より没入感のある審査体験を実現してください。各フェーズで動作確認を行い、段階的に機能を追加してください。